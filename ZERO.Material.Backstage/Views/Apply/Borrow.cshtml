@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Borrow</title>
</head>
<body>
    <table id="borrowTable" lay-filter="borrow"></table>

    <div id="tableCellTool" hidden>
        <button class="layui-btn layui-btn-normal layui-btn-xs" lay-event="allow">通过</button>
        <button class="layui-btn layui-btn-danger layui-btn-xs" lay-event="reject">驳回</button>
    </div>
    @Scripts.Render("~/bundles/jquery")
    @Styles.Render("~/Content/layui")
    @Scripts.Render("~/bundles/layui")

    <script>
        layui.use(['table','layer','form'], function () {
            var table = layui.table;
            var form = layui.form;
            var layer = layui.layer;
            var load = layer.load(1);
            var tableOption = {
                elem: "#borrowTable",
                //height: 100 %,
                url: "GetMaterialBorrow",
                loading: true,
                toolbar: "#baseTableToolBar",
                defaultToolbar: false,
                cellMinWidth: 50,
                page: true,
//                size:'lg',
                limits: [10, 20, 30, 40],
                text: "未加载到数据",
                cols: [[
                    { field: 'Teacher_Id', title: '教师编号', sort: true },
                    { field: 'Teacher_Name', title: '教师姓名' },
                    { field: 'Teacher_Depart', title: '教师系别' },
                    { field: 'Apply_Time', title: '申请时间', sort: true, templet: "<div>{{layui.util.toDateString(d.Apply_Time, 'yyyy-MM-dd ')}}</div>"},
                    { field: 'Start_Time', title: '使用时间', sort: true, templet: "<div>{{layui.util.toDateString(d.Start_Time, 'yyyy-MM-dd ')}}</div>"},
                    { field: 'End_Time', title: '使用时间', sort: true, templet: "<div>{{layui.util.toDateString(d.Start_Time, 'yyyy-MM-dd ')}}</div>" },
                    { field:'Teach_Depart',title:'使用系别'},
                    { field: 'Teach_Field', title: '使用专业' },
                    { field: 'Material_Name', title: '器材名称' },
                    { field: 'Apply_Count', title: '申请数量' },
                    { field: 'Needbuy_Count', title: '采购数量' },
                    { field: 'Head_Aduit', title: '审核结果', templet: function(d) {
                        var content = "<span class='layui-badge - rim'></span>"
                        if (d.Head_Aduit == "0") {
                            return "<span class='layui-badge-rim'>未审核</span>";
                        } else if (d.Head_Aduit == "1"){
                            return "<span class='layui-badge layui-bg-blue'>通过</span>";
                        } else if (d.Head_Aduit == "2") {
                            return "<span class='layui-badge'>驳回</span>";
                        }
                        return content;
                    }
                    },
                    { field: 'Head', title: "审核", toolbar: '#tableCellTool'}

                ]],
                done: function (res) {
                    layer.close(load);
                }
            };
            table.render(tableOption);

            table.on('tool(borrow)',
                function(obj) {
                    var data = obj.data; //获得当前行数据
                    var layEvent = obj.event; //获得 lay-event 对应的值（也可以是表头的 event 参数对应的值）

                    if (layEvent === 'allow' || layEvent === 'reject'){ //查看
                        layer.open({
                            title: "审批意见",
                            type: 1,
                            shadeClose: true,
                            shade: false,
                            btn: ['确定', '取消'],
                            yes: function(index,layero) {
                                var advice = layero["0"].childNodes[1].childNodes["0"].value;
                                data.Head_Aduit = layEvent === 'allow' ? 1 : 2;
                                data.Head_Advice = advice;
                                $.ajax({
                                    url: "Review",
                                    type: "POST",
                                    data: data,
                                    success: function(data) {
                                        if (data === "OK") {
                                            layer.msg("审核成功");
                                            layer.close(index);
                                        }
                                    }
                                });
                            },
                            area:["260px","200px"],
                            content: "<textarea name='' required lay-verify='required' placeholder='请输入审批意见' class='layui-textarea' style='width:100%;height:100%'></textarea>",
                            end: function () {
                                table.reload("borrowTable", tableOption);
                                //layer.msg("校徽");
                            }
                        });
                    }
                });

        })
    </script>
</body>
</html>